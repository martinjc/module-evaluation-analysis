<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Module Evaluation Comparison</title>
    <script src="//d3js.org/d3.v4.min.js"></script>
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300" rel="stylesheet">
    <style>
    body{

        font-family: "tee_franklin_light", 'Source Sans Pro', "Helvetica Neue",Helvetica,"Open Sans",Arial,sans-serif;
        font-weight: 300;
    }

    path.slice{
    	stroke-width:2px;
    }

    polyline{
    	opacity: .3;
    	stroke: black;
    	stroke-width: 2px;
    	fill: none;
    }
    </style>
</head>
<body>

    <div id="pie-chart">

    </div>

    <script>
        d3.csv('input/all_module_percent_agreement.csv', function(data){
            console.log(data);
            column = 'Overall, I am satisfied with the quality of this module.'
            my_data = data.map(function(d){ return { value : +d[column], key: d.index } });
            console.log(my_data);

            var width = 800;
            var height = 400;

            var margin = {
                top: 50,
                bottom: 50,
                left: 100,
                right: 100,
            };

            var pformat = d3.format('.1%');

            var svg = d3.select("#pie-chart")
                .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

            width = width - margin.left - margin.right;
            height = height - margin.top - margin.bottom;

            svg = svg
                .append("g")
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            svg.append("g")
                .attr("class", "slices")

            svg.append("g")
                .attr("class", "labels")

            svg.append("g")
                .attr("class", "lines")

            var radius = Math.min(width, height)/2;

            var color = d3.scaleOrdinal()
                .domain(['N/A', 'Disagree', 'Neither Agree nor Disagree', 'Agree'])
                .range(["#222", "hsla(0, 60%, 50%, 1)", "hsla(45, 70%, 60%, 1)", "hsla(90, 50%, 50%, 1)"]);

            var arc = d3.arc()
                .outerRadius(radius * 0.6)
                .innerRadius(radius * 0.1)
                .padAngle(.02)
                .padRadius(100)
                .cornerRadius(2);

            var labelArc = d3.arc()
                .outerRadius(radius * 0.9)
                .innerRadius(radius * 0.9);

            var pie = d3.pie()
                .sort(null)
                .value(function(d) { return d.value; });

            var key = function(d){ return d.data.key; }

            var slice = svg.select(".slices")
                    .selectAll("path.slice")
                    .data(pie(my_data), key);
                slice
                  .enter()
                  .insert("path")
                  .attr("d", arc)
                  .attr("class", "slice")
                  .style("stroke", "black")
                  .style("stroke-width", "0.5px")
                  .style("fill", function(d) { return color(d.data.key); });

            var text = svg.select(".labels")
                    .selectAll("text")
                    .data(pie(my_data), key);

            function midAngle(d) {
                return d.startAngle + (d.endAngle - d.startAngle)/2;
            }

            text
                .enter()
                  .append("text")
                  .attr("transform", function(d) {
                      var pos = labelArc.centroid(d);
                      pos[0] = radius * (midAngle(d) < Math.PI ? 1 : -1);
                      return "translate(" + pos + ")";
                  })
                  .style("text-anchor", function(d){
                      return midAngle(d) < Math.PI ? "start":"end";
                  })
                  .attr("dy", ".35em")
                  .attr("dx", ".35em")
                  .attr("fill", "#111")
                  .text(function(d) { return d.data.key + " (" + pformat(d.data.value) + ")"; });

            var polyline = svg.select(".lines")
                        .selectAll("polyline")
                        .data(pie(my_data), key);

            polyline.enter()
                .append("polyline")
                .attr("points", function(d){
                    var pos = labelArc.centroid(d);
                    pos[0] = radius * 0.95 * (midAngle(d) < Math.PI ? 1 : -1);
                    return [arc.centroid(d), labelArc.centroid(d), pos];
                });
        })
    </script>

</body>
</html>
