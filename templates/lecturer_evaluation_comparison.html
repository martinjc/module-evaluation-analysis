<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Module Evaluation Analysis</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="evaluation_data" style="display:none;">
<div class="data_comparison" id="comparison_data">{{data.comparison}}</div>
<div class="data_subsets">{{data.subsets}}</div>
    </div>

    <div class="page_a4">
        <section id="front_page">
            <h1>{{module}} (Academic Year {{year}}) (n={{count}})</h1>
            <div id="overall_evaluation">
                <h2>Overall Evaluation</h2>
                <p>Overall, I am satisfied with the quality of this module.</p>
                <div id="overall_pie_vis"></div>
            </div>
            <div id="highlow">
                <h2>Highlights and Lowlights</h2>
                <div class="highlights">
                    <h3>Highest Scores</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>
                                    Question
                                </th>
                                <th>
                                    % Agreement
                                </th>
                                <th>
                                    School Average
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for number in range(3) %}
                            <tr>
                                <td id="highlights_{{number}}_question"></td>
                                <td id="highlights_{{number}}_agreement"></td>
                                <td id="highlights_{{number}}_average"></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="lowlights">
                    <h3>Lowest Scores</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>
                                    Question
                                </th>
                                <th>
                                    % Agreement
                                </th>
                                <th>
                                    School Average
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for number in range(3) %}
                            <tr>
                                <td id="lowlights_{{number}}_question"></td>
                                <td id="lowlights_{{number}}_agreement"></td>
                                <td id="lowlights_{{number}}_average"></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <div class="page_a4">
        <section id="agreement_against_average">
            <h2>Percentage Agreement vs. School Average</h2>
            <p>The following shows the percentage agreement for all evaluation questions, against the average for all school modules included in this evaluation</p>
            <div id="agreement_evaluation_vis"></div>
        </section>
    </div>
    <div class="page_a4">
        <section id="evaluation_comparison">
            <h2>Question Breakdown</h2>
            <p>The following shows the percentage breakdown of N/A, Disagree, Neither Agree nor Disagree and Agree for all evaluation questions, against the average for all school modules included in this evaluation</p>
            <div id="overall_evaluation_vis"></div>
        </section>
        <section id="attribution">
            <footer>
                <p>
                <small>
                Generated by "module-evaluation-analysis" by <a href="http://www.martinjc.com">Martin Chorley</a> (<a href="https://www.twitter.com/martinjc">@martinjc</a>)<br>Code available at <a href="https://gitlab.cs.cf.ac.uk/comsc/module-review-analysis">https://gitlab.cs.cf.ac.uk/comsc/module-review-analysis</a> Licensed under the <a href="https://opensource.org/licenses/MIT">MIT Licence</a>. Pull requests always welcome.
                </small>
                </p>
            </footer>
        </section>
    </div>

    <script src="evaluation_pie.js"></script>
    <script src="highlowlights.js"></script>
    <script src="module_comparison.js"></script>
    <script src="against_average.js"></script>
    <script>
    (function() {

        var module_data = d3.csvParse(d3.select('#data_agreement_comparison')
            .html());

        module_data.forEach(function(d) {
            d.question = d.question.replace(': ', ''),
                d.module = +d.module;
            d.average = +d.AllModules;
            d.diff = (+d.module) - +(d.AllModules);
        })

        var chart = againstAverage()
            .width(1100)
            .height(600)
            .margin({
                top: 40,
                bottom: 20,
                left: 60,
                right: 400,
            })

        var container = d3.select("#agreement_evaluation_vis")
            .datum(module_data)
            .call(chart);

    })();

    (function() {

        var width = 600;
        var height = 400;

        var module_data = d3.csvParse(d3.select('#data_module')
            .html());
        var column = 'Overall, I am satisfied with the quality of this module.'

        this_data = []
        module_data.forEach(function(d) {
            if (d.question === column) {
                this_data = d;
            }
        });

        columns = module_data.columns.splice(1);

        var chart = evaluationPie()
            .width(600)
            .height(400)
            .margin({
                top: 20,
                bottom: 20,
                left: 100,
                right: 200,
            })
            .columns(columns);

        var container = d3.select("#overall_pie_vis")
            .datum(this_data)
            .call(chart);
    })();

    </script>
</body>
</html>
