<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Module Evaluation Analysis</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300" rel="stylesheet">
    <link rel="stylesheet" href="lecturer_style.css">
</head>
<body>
    <div id="evaluation_data" style="display:none;">
<div id="data_average">{{data.all_lecturer_percent_scores}}</div>
<div id="data_agreement_overall">{{data.agreement_overall}}</div>
    </div>

    <div class="page_a4">
        <section id="front_page">
            <h1>{{lecturer}} (n={{count}})</h1>
            <div id="overall_evaluation">
                <div class="wrapper">
                    <div class="pie" id="pie_vis0">
                        <h3 class="pie_title"></h3>
                    </div>
                    <div class="pie" id="pie_vis1">
                        <h3 class="pie_title"></h3>
                    </div>
                    <div class="pie" id="pie_vis2">
                        <h3 class="pie_title"></h3>
                    </div>
                </div>
            </div>
            <h2>School Average Comparison</h2>
            <div id="comparison"></div>
        </section>
    </div>

    <div class="page_a4">
        <section id="attribution">
            <footer>
                <p>
                <small>
                Generated by "module-evaluation-analysis" by <a href="http://www.martinjc.com">Martin James Chorley</a> (<a href="https://www.twitter.com/martinjc">@martinjc</a>)<br>
                Code available at <a href="https://gitlab.cs.cf.ac.uk/comsc/module-review-analysis">https://gitlab.cs.cf.ac.uk/comsc/module-review-analysis</a><br>
                Licensed under the <a href="https://opensource.org/licenses/MIT">MIT Licence</a>. Pull requests always welcome.
                </small>
                </p>
            </footer>
        </section>
    </div>

    <script src="evaluation_pie.js"></script>
    <script src="lecturer_pie.js"></script>
    <script src="against_average.js"></script>
    <script src="lecturer_against_average.js"></script>
    <script>
    (function() {

        var average_data = d3.csvParse(d3.select('#data_average')
            .html());

        var module_data = d3.csvParse(d3.select('#data_agreement_overall')
            .html());

        var comparison_data = module_data.map(function(d, i) {
            if (average_data[i].question === d.question) {
                return {
                    'question': d.question.replace(': ', ''),
                    'module': +d.Agree,
                    'average': +average_data[i].Agree,
                    'diff': (+d.Agree) - (+average_data[i].Agree)
                }
            }
        });

        var chart = againstAverage()
            .width(1100)
            .height(300)
            .margin({
                top: 40,
                bottom: 20,
                left: 60,
                right: 200,
            })

        var container = d3.select("#comparison")
            .datum(comparison_data)
            .call(chart);

    })();
    (function() {

        var module_data = d3.csvParse(d3.select('#data_agreement_overall')
            .html());
        var columns = module_data.columns.splice(1);

        module_data.forEach(function(d, i) {

            var chart = evaluationPie()
                .width(400)
                .height(250)
                .margin({
                    top: 20,
                    bottom: 40,
                    left: 120,
                    right: 120
                })
                .i(i)
                .columns(columns);

            var container = d3.select("#pie_vis" + i)
                .datum(d)
                .call(chart);

            container.select('h3')
                .html(d.question.replace(': ', ''));

        });

    })();
    </script>
</body>
</html>
