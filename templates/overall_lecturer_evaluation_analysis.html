<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lecturer Evaluation Analysis</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="evaluation_data" style="display:none;">
<div id="questions">{{question_titles|tojson}}</div>
<div id="lecturer_count">{{data.counts}}</div>
<div id="lecturer_subsets">{{data.subsets}}</div>
{% for question in questions %}
<div class="lecturer_comparison" id="q_data_{{question.id}}">{{question.data}}</div>
{% endfor %}
    </div>

    {% for question in questions %}
    <div class="page_a4">
        <div class="question">
            <h2>{{question.q}}</h2>
            <div class="vis" id="q_{{question.id}}"></div>
        </div>
    </div>
    {% endfor %}

    <div class="page_a4">
        <section id="attribution">
            <footer>
                <p>
                <small>
                Generated by "module-evaluation-analysis" by <a href="http://www.martinjc.com">Martin James Chorley</a> (<a href="https://www.twitter.com/martinjc">@martinjc</a>)<br>
                Code available at <a href="https://gitlab.cs.cf.ac.uk/comsc/module-review-analysis">https://gitlab.cs.cf.ac.uk/comsc/module-review-analysis</a><br>
                Licensed under the <a href="https://opensource.org/licenses/MIT">MIT Licence</a>. Pull requests always welcome.
                </small>
                </p>
            </footer>
        </section>
    </div>
    <script src="overall_lecturer_analysis.js"></script>
    <script>

        var subset_data = d3.csvParse(d3.select('#lecturer_subsets').html());

        var questions = JSON.parse(d3.select('#questions').html());

        questions.forEach(function(q, i){
            var question_data = d3.csvParseRows(d3.select('#q_data_'+ i).html(), function(d){
                return {
                    lecturer: d[0],
                    value: +d[1]
                }
            });

            var average_value = subset_data.filter(function(d){
                return d.question === q;
            })[0]['All Lecturers'];

            question_data.forEach(function(d){
                d.average = +average_value;
                d.diff = d.value - (+average_value);
            });

            var container = d3.select('#q_' + i);

            var chart = horizontalRankingChart()
                .average_value(+average_value);

            container
                .datum(question_data)
                .call(chart);
        });

    //     var comparison_data = average_data.map(function(d, i) {
    //         var average = +subset_data.filter(function(a){
    //             return a.question === d.question;
    //         })[0]['All Lecturers'];
    //         return {
    //             'question': d.question.replace(': ', ''),
    //             'Agree': +d.Agree,
    //             'average': average,
    //             'diff': (+d.Agree) - (+average)
    //         }
    //     });
    //
    //     var label_margin = 100;
    //
    // var pformat =
    //
    //     var questions = [
    //         ': Was good at explaining things.',
    //         ': Was available when needed.',
    //         ': Made the subject interesting.'
    //     ];
    // }
    // average_data.forEach(function(d) {
    //     average[d.question] = d.value;
    // });
    // lecturer_data = d3.csvParse(d3.select('#lecturer_comparison')
    //     .html());
    // lecturer_count = d3.csvParseRows(d3.select('#lecturer_count')
    //     .html(),
    //     function(d) {
    //         return {
    //             lecturer: d[0],
    //             count: +d[1]
    //         };
    //     });
    //
    // questions.forEach(function(q, i) {
    //
    //     var average_value = average[q];
    //
    //     var question_data = lecturer_data.map(function(d) {
    //         return {
    //             'lecturer': d.lecturer,
    //             'value': +d[q],
    //             'diff': (+d[q]) - average_value
    //         };
    //     });





    </script>
</body>
</html>
